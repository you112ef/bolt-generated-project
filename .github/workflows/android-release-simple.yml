name: Build Release APK (Simple)

on:
  push:
    branches:
      - cursor/**
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-24.04
    
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: ðŸ¤– Set up Android SDK
        uses: android-actions/setup-android@v0
        with:
          sdk-platform: '34'
          sdk-build-tools: '34.0.0'

      - name: ðŸ“ Create local.properties
        run: |
          echo "sdk.dir=$ANDROID_HOME" > local.properties
          echo "âœ… Created local.properties with Android SDK path: $ANDROID_HOME"

      - name: âœ… Accept Android SDK Licenses
        run: |
          yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --licenses

      - name: ðŸ”§ Make Gradle executable
        run: chmod +x ./gradlew

      - name: ðŸ§¹ Clean Project
        run: ./gradlew clean --no-daemon

      - name: ðŸ”¨ Build Release APK
        run: ./gradlew assembleRelease --no-daemon --stacktrace

      - name: ðŸ“± Upload Release APK
        uses: actions/upload-artifact@v4
        with:
          name: app-release-simple
          path: app/build/outputs/apk/release/app-release.apk
          retention-days: 30

      - name: ðŸ“Š Build Summary
        if: always()
        run: |
          echo "## ðŸŽ¯ Simple Release Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f "app/build/outputs/apk/release/app-release.apk" ]; then
            APK_SIZE=$(du -h "app/build/outputs/apk/release/app-release.apk" | cut -f1)
            echo "âœ… **Build Status**: SUCCESS" >> $GITHUB_STEP_SUMMARY
            echo "ðŸ“± **APK Size**: $APK_SIZE" >> $GITHUB_STEP_SUMMARY
            echo "ðŸ“¦ **APK Name**: app-release.apk" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **Build Status**: FAILED" >> $GITHUB_STEP_SUMMARY
            echo "ðŸ” **Debug Info**: No APK file found" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— **Repository**: [AIDE Android App](https://github.com/${{ github.repository }})" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŒŸ **Commit**: \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
          echo "ðŸƒ **Run Number**: \`${{ github.run_number }}\`" >> $GITHUB_STEP_SUMMARY